# 日報要約AI Chatwork連携ツール シナリオテスト手順書

## 1. テストの目的

Chatwork連携における設定情報の管理方法を、スクリプトプロパティからGoogleスプレッドシート（`Chatwork設定`シート）に移行したことによる機能改修が、仕様通りに正しく動作することを確認する。
また、本改修によるデグレード（既存機能への悪影響）が発生していないことを確認する。

## 2. テスト準備

### 2.1. スプレッドシートの準備

1.  **`Chatwork設定`シート**:
    *   以下のヘッダーを持つシートを作成する。
        *   `A列: グループ名`, `B列: 氏名`, `C列: ルームID`, `D列: 役割`
    *   テスト用のデータを2グループ以上入力する。各グループには`manager`1名と`employee`1名以上を必ず含める。
        *   **入力例:**

| グループ名 | 氏名 | ルームID | 役割 |
| :--- | :--- | :--- | :--- |
| 開発1G | マネージャーA | 10000001 | manager |
| 開発1G | メンバーA1 | 20000001 | employee |
| 開発2G | マネージャーB | 10000002 | manager |
| 開発2G | メンバーB1 | 20000002 | employee |

2.  **`日報ログ`シート**:
    *   ヘッダーが以下の順序になっていることを確認する。
        *   `A: タイムスタンプ`, `B: マネージャー名`, `C: 氏名`, `D: 日報日付`, `E: 今日の業務内容`, `F: 今日の気分`, `G: 困っていること`, `H: AI評価状態`, `I: AI評価理由`
    *   テスト前に、過去のログはクリアしておく。

3.  **`BOT質問ログ`シート**:
    *   テスト前に、過去のログはクリアしておく。

### 2.2. スクリプトプロパティの準備

1.  GASエディタの `プロジェクトの設定` > `スクリプト プロパティ` を開く。
2.  以下のプロパティが正しく設定されていることを確認する。
    *   `CHATWORK_API_KEY`
    *   `GEMINI_API_KEY`
    *   `TARGET_EMPLOYEE_NAME_FOR_1ON1`
3.  **`CHATWORK_ROOM_IDS` プロパティが削除されていることを確認する。**

---

## 3. テストシナリオ

### **シナリオ1: 正常系 - 日報の質問・収集・分析・通知**

---

#### **テストケースID: 1-1**
-   **テスト内容:** 日報質問の送信
-   **操作手順:**
    1.  `日報AIツール` > `日報質問送信（Chatwork）` を実行する。
-   **確認項目:**
    -   `Chatwork設定`シートに登録されている`employee`全員に、日報提出を促すメッセージが送信されること。
    -   `manager`には送信されないこと。
    -   `BOT質問ログ`シートに、送信した`employee`全員分のレコードが`未返信`ステータスで記録されること。

---

#### **テストケースID: 1-2**
-   **テスト内容:** 正常な日報の処理
-   **操作手順:**
    1.  `メンバーA1`が、BOTからの質問に返信する形で、正しいフォーマットの日報を提出する。
    2.  `日報AIツール` > `Chatwork日報取得・分析` を実行する。
-   **確認項目:**
    -   `日報ログ`シートに、`メンバーA1`の日報が記録されること。
    -   記録された行の`B列: マネージャー名`に`マネージャーA`の名前が正しく入っていること。
    -   `C列: 氏名`に`メンバーA1`の名前が正しく入っていること。
    -   `BOT質問ログ`シートの`メンバーA1`のレコードのステータスが`返信済み_処理成功`に更新されること。

---

#### **テストケースID: 1-3**
-   **テスト内容:** アラート通知
-   **操作手順:**
    1.  `メンバーB1`が、BOTからの質問に返信する形で、`気分：悪い` `困っていること：プロジェクトの進捗が遅れており、プレッシャーを感じています。` のようなネガティブな日報を提出する。
    2.  `日報AIツール` > `Chatwork日報取得・分析` を実行する。
-   **確認項目:**
    -   `マネージャーB`のChatwork（マイチャット）に、`メンバーB1`の不調を知らせるアラート通知が届くこと。
    -   `日報ログ`シートに、`メンバーB1`の日報が記録され、`AI評価状態`が`危険`または`少し悪い`になっていること。
    -   記録された行の`B列: マネージャー名`に`マネージャーB`の名前が正しく入っていること。

---

#### **テストケースID: 1-4**
-   **テスト内容:** 重複質問の防止
-   **操作手順:**
    1.  `メンバーA1`が日報を提出していない状態で、再度 `日報質問送信（Chatwork）` を実行する。
-   **確認項目:**
    -   `メンバーA1`には質問が送信されないこと。
    -   GASの実行ログに、質問送信をスキップした旨のメッセージが出力されること。

---

### **シナリオ2: 異常系 - 設定不備の確認**

---

#### **テストケースID: 2-1**
-   **テスト内容:** `Chatwork設定`シートが存在しない
-   **操作手順:**
    1.  `Chatwork設定`シートの名前を`Chatwork設定_bak`などに変更する。
    2.  `日報質問送信（Chatwork）` を実行する。
-   **確認項目:**
    -   GASの実行ログに「シート「Chatwork設定」が見つかりません。」というエラーが出力され、処理が停止すること。

---

#### **テストケースID: 2-2**
-   **テスト内容:** マネージャーがいないグループ
-   **操作手順:**
    1.  `Chatwork設定`シートで、`開発1G`の`マネージャーA`の行を削除する。
    2.  `日報質問送信（Chatwork）` を実行する。
-   **確認項目:**
    -   `メンバーA1`には質問が送信されないこと。
    -   GASの実行ログに「社員「メンバーA1」のグループ「開発1G」に対応するマネージャーが見つかりません。」という警告が出力されること。
    -   `開発2G`の`メンバーB1`には通常通り質問が送信されること。

---

### **シナリオ3: 1on1ヒアリング項目生成**

---

#### **テストケースID: 3-1**
-   **テスト内容:** 正常な項目生成
-   **操作手順:**
    1.  `日報ログ`シートに`メンバーA1`の日報が数件記録されている状態にする。
    2.  スクリプトプロパティ`TARGET_EMPLOYEE_NAME_FOR_1ON1`の値を`メンバーA1`に設定する。
    3.  `日報AIツール` > `1on1ヒアリング項目生成` を実行する。
-   **確認項目:**
    -   `マネージャーA`のChatwork（マイチャット）に、`メンバーA1`向けの1on1ヒアリング項目が通知されること。

---

#### **テストケースID: 3-2**
-   **テスト内容:** 対象者不在
-   **操作手順:**
    1.  スクリプトプロパティ`TARGET_EMPLOYEE_NAME_FOR_1ON1`の値を、`Chatwork設定`シートに存在しない`テストユーザー`に設定する。
    2.  `1on1ヒアリング項目生成` を実行する。
-   **確認項目:**
    -   「「Chatwork設定」シートに「テストユーザー」さんが見つかりません。」というアラートがスプレッドシート上に表示されること。

---