# 日報要約AI Chatwork連携ツール シナリオテスト手順書

## 1. テストの目的

- 週次レポートの生成モード（メンバーごと/チームごと）が`Chatwork設定`シートの設定に応じて正しく機能することを確認する。
- `getChatworkTargetGroups()` 関数が新しいデータ構造を正しく返すことを確認する。
- `generateWeeklyTeamSummary()` 関数がモードに応じて適切なレポートを生成・通知することを確認する。
- 本機能の追加によるデグレード（既存機能への悪影響）が発生していないことを確認する。

## 2. テスト準備

### 2.1. スプレッドシートの準備

1.  **`Chatwork設定`シート**:
    *   以下の構造でテストデータを準備する。
        *   **グループA**: `週次レポートモード`を`individual`に設定したマネージャーと、複数名（最低2名）の`employee`。
        *   **グループB**: `週次レポートモード`を`team`に設定したマネージャーと、複数名（最低2名）の`employee`。
        *   **グループC**: `週次レポートモード`が未設定（または空欄）のマネージャーと、複数名（最低2名）の`employee`。

        | グループ名 | 氏名 | ルームID | 役割 | 週次レポートモード |
        | :--- | :--- | :--- | :--- | :--- |
        | グループA | マネージャーA | room_id_MA | manager | individual |
        | グループA | メンバーA1 | room_id_A1 | employee | |
        | グループA | メンバーA2 | room_id_A2 | employee | |
        | グループB | マネージャーB | room_id_MB | manager | team |
        | グループB | メンバーB1 | room_id_B1 | employee | |
        | グループB | メンバーB2 | room_id_B2 | employee | |
        | グループC | マネージャーC | room_id_MC | manager | |
        | グループC | メンバーC1 | room_id_C1 | employee | |
        | グループC | メンバーC2 | room_id_C2 | employee | |

2.  **`日報ログ`シート**:
    *   テスト前に、過去のログを一度クリアする。
    *   **過去1週間以内**の日付を持つテストデータを、上記`Chatwork設定`シートの全メンバー（A1, A2, B1, B2, C1, C2）についてそれぞれ最低2件ずつ入力する。
        *   データには「良い」「普通」「悪い」など、様々な`今日の気分`を混ぜて入力する。
        *   `困っていること`の項目には、「残業」「コミュニケーション」など、複数のメンバーで重複するキーワードを意図的に含める。
        *   `今日の業務内容`には、「〇〇が完了」「△△を達成」といったポジティブな内容と、通常の業務内容を混ぜて入力する。

### 2.2. スクリプトプロパティの準備

1.  GASエディタの `プロジェクトの設定` > `スクリプト プロパティ` を開く。
2.  以下のプロパティが正しく設定されていることを確認する。
    *   `CHATWORK_API_KEY`
    *   `GEMINI_API_KEY`

## 3. テストシナリオ

### **シナリオ1: `individual`モードのグループの週次レポート生成**

#### **テストケースID: WRS-001**
-   **テスト内容:** `weeklyReportMode`が`individual`のグループ（グループA）に対して、メンバーごとの週次レポートが生成・通知されることの確認。
-   **操作手順:**
    1.  `Chatwork設定`シートが上記2.1の準備状態であることを確認する。
    2.  `日報ログ`シートに、以下のグループAのメンバーの日報データを準備する。

        | タイムスタンプ | 氏名 | マネージャー | 日報日付 | 今日の業務内容 | 今日の気分 | 困っていること | AI評価状態 | AI評価理由 |
        | :------------- | :--- | :----------- | :------- | :------------- | :--------- | :------------- | :--------- | :--------- |
        | 2025/07/09 09:00:00 | メンバーA1 | マネージャーA | 2025/07/09 | プロジェクトXの設計レビュー完了。 | 良い | 特になし | 非常に良い | 問題なし |
        | 2025/07/10 09:00:00 | メンバーA2 | マネージャーA | 2025/07/10 | 新機能開発。少し詰まった。 | 少し悪い | 技術的な不明点 | 少し悪い | 新しい技術で不明点があったため。 |
        | 2025/07/12 09:00:00 | メンバーA1 | マネージャーA | 2025/07/12 | 顧客ミーティング。順調に進捗。 | 普通 | 特になし | 普通 | 問題なし |
        | 2025/07/13 09:00:00 | メンバーA2 | マネージャーA | 2025/07/13 | ドキュメント作成。集中できた。 | 良い | 特になし | 非常に良い | 問題なし |

    3.  `日報AIツール` > `週次チームサマリー生成` を実行する。
-   **確認項目:**
    1.  マネージャーAのChatworkに、メンバーA1とメンバーA2それぞれについて、以下の件名のメッセージがBOTから通知されること。
        *   `【週次メンバーコンディションレポート】メンバーA1 - [日付]週`
        *   `【週次メンバーコンディションレポート】メンバーA2 - [日付]週`
    2.  各レポートの本文が、それぞれのメンバーの日報データに基づいた内容であること。
    3.  GASの実行ログに、メンバーごとのレポート生成と通知に関するログが出力されていること。

### **シナリオ2: `team`モードのグループの週次レポート生成**

#### **テストケースID: WRS-002**
-   **テスト内容:** `weeklyReportMode`が`team`のグループ（グループB）に対して、チーム全体の週次レポートが生成・通知されることの確認。
-   **操作手順:**
    1.  `Chatwork設定`シートが上記2.1の準備状態であることを確認する。
    2.  `日報ログ`シートに、以下のグループBのメンバーの日報データを準備する。

        | タイムスタンプ | 氏名 | マネージャー | 日報日付 | 今日の業務内容 | 今日の気分 | 困っていること | AI評価状態 | AI評価理由 |
        | :------------- | :--- | :----------- | :------- | :------------- | :--------- | :------------- | :--------- | :--------- |
        | 2025/07/09 09:00:00 | メンバーB1 | マネージャーB | 2025/07/09 | チーム内調整に時間。 | 普通 | コミュニケーション | 普通 | 問題なし |
        | 2025/07/10 09:00:00 | メンバーB2 | マネージャーB | 2025/07/10 | 〇〇機能リリース。 | 良い | 特になし | 非常に良い | 問題なし |
        | 2025/07/12 09:00:00 | メンバーB1 | マネージャーB | 2025/07/12 | 開発環境のトラブル。 | 悪い | 環境構築 | 危険 | 開発環境のトラブルで業務が滞ったため。 |
        | 2025/07/13 09:00:00 | メンバーB2 | マネージャーB | 2025/07/13 | 顧客からの感謝の言葉。 | 良い | 特になし | 非常に良い | 問題なし |

    3.  `日報AIツール` > `週次チームサマリー生成` を実行する。
-   **確認項目:**
    1.  マネージャーBのChatworkに、以下の件名のメッセージがBOTから通知されること。
        *   `【週次チームコンディションサマリー】グループB - [日付]週`
    2.  レポートの本文が、グループBの全メンバーの日報データを集計・分析した内容であること。
    3.  GASの実行ログに、チーム全体のレポート生成と通知に関するログが出力されていること。

### **シナリオ3: `週次レポートモード`が未設定のグループの週次レポート生成**

#### **テストケースID: WRS-003**
-   **テスト内容:** `weeklyReportMode`が未設定のグループ（グループC）に対して、デフォルトの`individual`モードでレポートが生成・通知されることの確認。
-   **操作手順:**
    1.  `Chatwork設定`シートが上記2.1の準備状態であることを確認する。
    2.  `日報ログ`シートに、以下のグループCのメンバーの日報データを準備する。

        | タイムスタンプ | 氏名 | マネージャー | 日報日付 | 今日の業務内容 | 今日の気分 | 困っていること | AI評価状態 | AI評価理由 |
        | :------------- | :--- | :----------- | :------- | :------------- | :--------- | :------------- | :--------- | :--------- |
        | 2025/07/09 09:00:00 | メンバーC1 | マネージャーC | 2025/07/09 | 残業続きで疲労。 | 悪い | 疲労、残業 | 危険 | 残業が続き疲労が蓄積しているため。 |
        | 2025/07/10 09:00:00 | メンバーC2 | マネージャーC | 2025/07/10 | 業務効率化ツール導入。 | 良い | 特になし | 非常に良い | 問題なし |
        | 2025/07/12 09:00:00 | メンバーC1 | マネージャーC | 2025/07/12 | 新規タスクの調査。 | 普通 | 情報不足 | 普通 | 問題なし |
        | 2025/07/13 09:00:00 | メンバーC2 | マネージャーC | 2025/07/13 | チームミーティング。活発な議論。 | 良い | 特になし | 非常に良い | 問題なし |

    3.  `日報AIツール` > `週次チームサマリー生成` を実行する。
-   **確認項目:**
    1.  マネージャーCのChatworkに、メンバーC1とメンバーC2それぞれについて、以下の件名のメッセージがBOTから通知されること。
        *   `【週次メンバーコンディションレポート】メンバーC1 - [日付]週`
        *   `【週次メンバーコンディションレポート】メンバーC2 - [日付]週`
    2.  各レポートの本文が、それぞれのメンバーの日報データに基づいた内容であること。
    3.  GASの実行ログに、メンバーごとのレポート生成と通知に関するログが出力されていること。

### **シナリオ4: 日報データが存在しない場合の動作確認**

#### **テストケースID: WRS-004**
-   **テスト内容:** 特定のメンバーまたはグループの日報データが過去1週間分存在しない場合の動作確認。
-   **操作手順:**
    1.  `Chatwork設定`シートは上記2.1の準備状態とする。
    2.  `日報ログ`シートから、グループAのメンバーA1の日報データを全て削除するか、1週間以上前の日付に変更する。
        *   **メンバーA1のデータ例（1週間以上前）**:

            | タイムスタンプ | 氏名 | マネージャー | 日報日付 | 今日の業務内容 | 今日の気分 | 困っていること | AI評価状態 | AI評価理由 |
            | :------------- | :--- | :----------- | :------- | :------------- | :--------- | :------------- | :--------- | :--------- |
            | 2025/07/01 09:00:00 | メンバーA1 | マネージャーA | 2025/07/01 | 古いデータ。 | 普通 | 特になし | 普通 | 問題なし |

    3.  `日報AIツール` > `週次チームサマリー生成` を実行する。
-   **確認項目:**
    1.  マネージャーAのChatworkには、メンバーA2のレポートのみが通知され、メンバーA1のレポートは通知されないこと。
    2.  GASの実行ログに「メンバー「メンバーA1」の過去1週間の日報データがありません。スキップします。」のようなログが出力されていること。
    3.  同様に、グループBの全メンバーの日報データを削除または1週間以上前の日付に変更した場合、マネージャーBにはレポートが通知されず、ログに「グループ「グループB」の過去1週間の日報データがありません。スキップします。」のようなログが出力されること。
        *   **グループBの全メンバーのデータ例（1週間以上前）**:

            | タイムスタンプ | 氏名 | マネージャー | 日報日付 | 今日の業務内容 | 今日の気分 | 困っていること | AI評価状態 | AI評価理由 |
            | :------------- | :--- | :----------- | :------- | :------------- | :--------- | :------------- | :--------- | :--------- |
            | 2025/07/01 10:00:00 | メンバーB1 | マネージャーB | 2025/07/01 | 古いデータ1。 | 普通 | 特になし | 普通 | 問題なし |
            | 2025/07/02 10:00:00 | メンバーB2 | マネージャーB | 2025/07/02 | 古いデータ2。 | 良い | 特になし | 非常に良い | 問題なし |

### **シナリオ5: トリガーによる自動実行の確認**

#### **テストケースID: WRS-005**
-   **テスト内容:** トリガーによる自動実行が、各グループの`週次レポートモード`設定を尊重して行われることの確認。
-   **操作手順:**
    1.  `Chatwork設定`シートと`日報ログ`シートが上記2.1の準備状態であることを確認する。
        *   **日報ログデータ例（全メンバーの過去1週間分）**:

            | タイムスタンプ | 氏名 | マネージャー | 日報日付 | 今日の業務内容 | 今日の気分 | 困っていること | AI評価状態 | AI評価理由 |
            | :------------- | :--- | :----------- | :------- | :------------- | :--------- | :------------- | :--------- | :--------- |
            | 2025/07/09 09:00:00 | メンバーA1 | マネージャーA | 2025/07/09 | プロジェクトXの設計レビュー完了。 | 良い | 特になし | 非常に良い | 問題なし |
            | 2025/07/09 09:00:00 | メンバーB1 | マネージャーB | 2025/07/09 | チーム内調整に時間。 | 普通 | コミュニケーション | 普通 | 問題なし |
            | 2025/07/09 09:00:00 | メンバーC1 | マネージャーC | 2025/07/09 | 残業続きで疲労。 | 悪い | 疲労、残業 | 危険 | 残業が続き疲労が蓄積しているため。 |
            | 2025/07/10 09:00:00 | メンバーA2 | マネージャーA | 2025/07/10 | 新機能開発。少し詰まった。 | 少し悪い | 技術的な不明点 | 少し悪い | 新しい技術で不明点があったため。 |
            | 2025/07/10 09:00:00 | メンバーB2 | マネージャーB | 2025/07/10 | 〇〇機能リリース。 | 良い | 特になし | 非常に良い | 問題なし |
            | 2025/07/10 09:00:00 | メンバーC2 | マネージャーC | 2025/07/10 | 業務効率化ツール導入。 | 良い | 特になし | 非常に良い | 問題なし |
            | 2025/07/12 09:00:00 | メンバーA1 | マネージャーA | 2025/07/12 | 顧客ミーティング。順調に進捗。 | 普通 | 特になし | 普通 | 問題なし |
            | 2025/07/12 09:00:00 | メンバーB1 | マネージャーB | 2025/07/12 | 開発環境のトラブル。 | 悪い | 環境構築 | 危険 | 開発環境のトラブルで業務が滞ったため。 |
            | 2025/07/12 09:00:00 | メンバーC1 | マネージャーC | 2025/07/12 | 新規タスクの調査。 | 普通 | 情報不足 | 普通 | 問題なし |
            | 2025/07/13 09:00:00 | メンバーA2 | マネージャーA | 2025/07/13 | ドキュメント作成。集中できた。 | 良い | 特になし | 非常に良い | 問題なし |
            | 2025/07/13 09:00:00 | メンバーB2 | マネージャーB | 2025/07/13 | 顧客からの感謝の言葉。 | 良い | 特になし | 非常に良い | 問題なし |
            | 2025/07/13 09:00:00 | メンバーC2 | マネージャーC | 2025/07/13 | チームミーティング。活発な議論。 | 良い | 特になし | 非常に良い | 問題なし |

    2.  `日報AIツール` > `定期実行トリガーを設定` を実行する。
    3.  GASエディタの `トリガー` 画面を開き、`generateWeeklyTeamSummary` 関数のトリガーが「毎週月曜日 午前10時」に設定されていることを確認する。
    4.  （テストのため）トリガーの時刻を現在時刻の数分後に変更して保存し、指定時刻を待つ。
-   **確認項目:**
    1.  指定時刻になると、`generateWeeklyTeamSummary` 関数が自動実行されること（GASの「実行数」画面で実行履歴を確認）。
    2.  マネージャーAにはメンバーごとのレポートが、マネージャーBにはチームごとのレポートが、マネージャーCにはメンバーごとのレポートがそれぞれ通知されること。
    3.  テスト後、トリガーの時刻を元の「午前10時」に戻しておくこと。