# 日報要約AI Chatwork連携ツール シナリオテスト手順書

## 1. テストの目的

定数や設定値を`CONFIG`オブジェクトに一元管理するリファクタリングを行った後も、ツールの全機能が仕様通りに正しく動作することを確認する。
また、本改修によるデグレード（既存機能への悪影響）が発生していないことを確認する。

## 2. テスト準備

### 2.1. スプレッドシートの準備

1.  **`Chatwork設定`シート**:
    *   `CONFIG.CHATWORK_SETTINGS_HEADERS`で定義されたヘッダー (`グループ名`, `氏名`, `ルームID`, `役割`) を持つことを確認する。
    *   テスト用のデータを2グループ以上入力する。各グループには`manager`1名と`employee`1名以上を必ず含める。

2.  **`日報ログ`シート**:
    *   `CONFIG.DAILY_REPORT_LOG_SHEET_NAME` (`日報ログ`) という名前であることを確認する。
    *   テスト前に、過去のログはクリアしておく。

3.  **`BOT質問ログ`シート**:
    *   `CONFIG.BOT_QUESTION_LOG_SHEET_NAME` (`BOT質問ログ`) という名前であることを確認する。
    *   テスト前に、過去のログはクリアしておく。

### 2.2. スクリプトプロパティの準備

1.  GASエディタの `プロジェクトの設定` > `スクリプト プロパティ` を開く。
2.  以下のプロパティが正しく設定されていることを確認する。
    *   `CHATWORK_API_KEY`
    *   `GEMINI_API_KEY`
    *   `TARGET_EMPLOYEE_NAME_FOR_1ON1` (テスト対象の社員名)
    *   `SELF_EVALUATION_FOLDER_ID`
    *   `SELF_EVALUATION_INPUT_SHEET_NAME`

---

## 3. テストシナリオ

### **シナリオ1: 主要機能の正常系動作確認**

---

#### **テストケースID: CFG-001**
-   **テスト内容:** 日報質問の送信
-   **操作手順:**
    1.  `日報AIツール` > `日報質問送信（Chatwork）` を実行する。
-   **確認項目:**
    -   `Chatwork設定`シートに登録されている`employee`全員に、日報提出を促すメッセージが送信されること。
    -   `BOT質問ログ`シートに、送信した`employee`全員分のレコードが`未返信`ステータスで記録されること。

---

#### **テストケースID: CFG-002**
-   **テスト内容:** 正常な日報の処理とログ記録
-   **操作手順:**
    1.  テスト対象の`employee`が、BOTからの質問に返信する形で、正しいフォーマットの日報を提出する。
    2.  `日報AIツール` > `Chatwork日報取得・分析` を実行する。
-   **確認項目:**
    -   `日報ログ`シートに、提出された日報が正しく記録されること。
    -   記録された行の`マネージャー名`が正しく紐付いていること。
    -   `BOT質問ログ`シートの該当レコードのステータスが`返信済み_処理成功`に更新されること。

---

#### **テストケースID: CFG-003**
-   **テスト内容:** アラート通知
-   **操作手順:**
    1.  テスト対象の`employee`が、`CONFIG.MOOD_OPTIONS`に含まれるネガティブな気分（例: `悪い`）で日報を提出する。
    2.  `日報AIツール` > `Chatwork日報取得・分析` を実行する。
-   **確認項目:**
    -   担当マネージャーのChatwork（マイチャット）に、不調を知らせるアラート通知が届くこと。
    -   `日報ログ`シートに記録された`AI評価状態`が`危険`または`少し悪い`になっていること。

---

#### **テストケースID: CFG-004**
-   **テスト内容:** 1on1ヒアリング項目生成
-   **操作手順:**
    1.  `日報ログ`シートにテスト対象者の日報が数件記録されている状態にする。
    2.  スクリプトプロパティ`TARGET_EMPLOYEE_NAME_FOR_1ON1`の値をテスト対象者に設定する。
    3.  `日報AIツール` > `1on1ヒアリング項目生成` を実行する。
-   **確認項目:**
    -   担当マネージャーのChatwork（マイチャット）に、対象者向けの1on1ヒアリング項目が通知されること。
    -   GASの実行ログを確認し、`getDailyReportDataForEmployee`関数内で日報データを集約する際、`CONFIG.PROBLEM_KEYWORDS`や`CONFIG.REPRESENTATIVE_REPORTS_COUNT`といった設定値が正しく参照されていること（ログから間接的に確認）。

---

### **シナリオ2: CONFIG値の変更反映確認**

---

#### **テストケースID: CFG-005**
-   **テスト内容:** `CONFIG`内の設定値変更が機能に反映されることの確認
-   **操作手順:**
    1.  GASエディタで`CONFIG.REPRESENTATIVE_REPORTS_COUNT`の値を `5` から `3` に変更して保存する。
    2.  `日報ログ`シートにテスト対象者の日報が5件以上ある状態で、`日報AIツール` > `1on1ヒアリング項目生成` を実行する。
    3.  実行後、GASエディタの「実行ログ」を開く。
-   **確認項目:**
    -   実行ログに出力されるGeminiへの最終プロンプト（または`getDailyReportDataForEmployee`関数の戻り値）に含まれる「代表的な日報の抜粋」が、**3件**になっていること。
    -   テスト完了後、`CONFIG.REPRESENTATIVE_REPORTS_COUNT`の値を元の `5` に戻すこと。

---
