# 日報要約AI Chatwork連携ツール シナリオテスト手順書

## 1. テストの目的

- 週次レポート機能の改修（レポートモードの導入）が、仕様通りに正しく動作することを確認する。
- `Chatwork設定`シートの`週次レポートモード`列（`individual` / `team`）に応じて、適切なレポートが生成・通知されることを確認する。
- 本機能改修によるデグレード（既存機能への悪影響）が発生していないことを確認する。

## 2. テスト準備

### 2.1. スプレッドシートの準備

**本テストの前提として、以下の`Chatwork設定`シートと`日報ログ`シートの両方に、整合性のとれたテストデータを準備する必要があります。**

1.  **`Chatwork設定`シート**:
    *   ヘッダーに `週次レポートモード` 列を追加する。
    *   以下の構造でテストデータを準備する。この設定が、どのマネージャーがどのレポートを受け取るかを決定します。
        *   **グループA**: `週次レポートモード`を`individual`に設定したマネージャーと、複数名（最低2名）の`employee`。
        *   **グループB**: `週次レポートモード`を`team`に設定したマネージャーと、複数名（最低2名）の`employee`。
        *   **グループC**: `週次レポートモード`が未設定（または空欄）のマネージャーと、複数名（最低2名）の`employee`。（デフォルトで`individual`として動作することを期待）

        | グループ名 | 氏名 | ルームID | 役割 | 週次レポートモード |
        | :--- | :--- | :--- | :--- | :--- |
        | グループA | マネージャーA | (room_id_MA) | manager | individual |
        | グループA | メンバーA1 | (room_id_A1) | employee | |
        | グループA | メンバーA2 | (room_id_A2) | employee | |
        | グループB | マネージャーB | (room_id_MB) | manager | team |
        | グループB | メンバーB1 | (room_id_B1) | employee | |
        | グループB | メンバーB2 | (room_id_B2) | employee | |
        | グループC | マネージャーC | (room_id_MC) | manager | |
        | グループC | メンバーC1 | (room_id_C1) | employee | |
        | グループC | メンバーC2 | (room_id_C2) | employee | |

2.  **`日報ログ`シート**:
    *   テスト前に、過去のログを一度クリアする。
    *   **過去1週間以内**の日付を持つテストデータを、上記`Chatwork設定`シートの全メンバー（A1, A2, B1, B2, C1, C2）についてそれぞれ最低2件ずつ入力する。
        *   データには「良い」「普通」「悪い」など、様々な`今日の気分`を混ぜて入力する。
        *   `困っていること`の項目には、「残業」「コミュニケーション」など、複数のメンバーで重複するキーワードを意図的に含める（`team`モードのテストのため）。
        *   `今日の業務内容`には、「〇〇が完了」「△△を達成」といったポジティブな内容と、通常の業務内容を混ぜて入力する。

### 2.2. スクリプトプロパティの準備

1.  GASエディタの `プロジェクトの設定` > `スクリプト プロパティ` を開く。
2.  以下のプロパティが正しく設定されていることを確認する。
    *   `CHATWORK_API_KEY`
    *   `GEMINI_API_KEY`

---

## 3. テストシナリオ

### **シナリオ1: `individual`モードの週次レポート生成**

#### **テストケースID: WR-001**
-   **テスト内容:** `週次レポートモード`が`individual`のグループ（グループA）に対して、メンバーごとの「週次メンバーコンディションレポート」が生成・通知されること。
-   **事前準備（`日報ログ`シート）**:
    | タイムスタンプ | 氏名 | マネージャー | 日報日付 | 今日の業務内容 | 今日の気分 | 困っていること |
    | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
    | 2025/07/09 | メンバーA1 | マネージャーA | 2025/07/09 | 設計書作成 | 良い | 特になし |
    | 2025/07/13 | メンバーA1 | マネージャーA | 2025/07/13 | 顧客からの問い合わせ対応 | 普通 | プレッシャーを感じる |
    | 2025/07/09 | メンバーA2 | マネージャーA | 2025/07/09 | コードレビュー | 普通 | 特になし |
    | 2025/07/14 | メンバーA2 | マネージャーA | 2025/07/14 | 新機能のテスト | 良い | 軽微なバグを発見 |
-   **操作手順:**
    1.  `日報AIツール` > `週次レポート生成` を実行する。
-   **確認項目:**
    1.  マネージャーAのChatworkに、**メンバーごと**のレポートが通知されること。
        *   件名が「【週次メンバーコンディションレポート】」で始まること。
    2.  通知された各レポートの本文に、該当メンバーの過去1週間分の日報（日付、業務内容、気分、困っていること、AI評価など）が**生データの形式で**記載されていること。
    3.  GASの実行ログに、`individual`モードでレポートが生成された旨のログが出力されること。

---

### **シナリオ2: `team`モードの週次レポート生成**

#### **テストケースID: WR-002**
-   **テスト内容:** `週次レポートモード`が`team`のグループ（グループB）に対して、チーム全体の「週次チームコンディションサマリー」が生成・通知されること。
-   **事前準備（`日報ログ`シート）**:
    | タイムスタンプ | 氏名 | マネージャー | 日報日付 | 今日の業務内容 | 今日の気分 | 困っていること |
    | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
    | 2025/07/11 | メンバーB1 | マネージャーB | 2025/07/11 | チーム定例 | 普通 | チーム内のコミュニケーション不足 |
    | 2025/07/12 | メンバーB1 | マネージャーB | 2025/07/12 | 緊急の障害対応 | 悪い | 残業 |
    | 2025/07/11 | メンバーB2 | マネージャーB | 2025/07/11 | 〇〇機能のリリース作業 | 良い | 特になし |
    | 2025/07/13 | メンバーB2 | マネージャーB | 2025/07/13 | 後輩のサポート | 普通 | 特になし |
-   **操作手順:**
    1.  `日報AIツール` > `週次レポート生成` を実行する。
-   **確認項目:**
    1.  マネージャーBのChatworkに、**チーム全体で1つ**のレポートが通知されること。
        *   件名が「【週次チームコンディションサマリー】」で始まること。
    2.  通知されたレポートの本文が、グループBの全メンバーの日報データを**Geminiが要約した内容**になっていること。（気分傾向、共通の課題（コミュニケーション、残業）、ポジティブな動き（リリース）などが含まれている）
    3.  GASの実行ログに、`team`モードでレポートが生成された旨のログが出力されること。

---

### **シナリオ3: `週次レポートモード`未設定（デフォルト動作）**

#### **テストケースID: WR-003**
-   **テスト内容:** `週次レポートモード`が未設定のグループ（グループC）に対して、デフォルトである`individual`モードのレポートが生成・通知されること。
-   **事前準備（`日報ログ`シート）**:
    | タイムスタンプ | 氏名 | マネージャー | 日報日付 | 今日の業務内容 | 今日の気分 | 困っていること |
    | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
    | 2025/07/10 | メンバーC1 | マネージャーC | 2025/07/10 | 企画書の作成 | 普通 | 特になし |
    | 2025/07/14 | メンバーC1 | マネージャーC | 2025/07/14 | プレゼン準備 | 少し悪い | 資料作成が遅延 |
    | 2025/07/12 | メンバーC2 | マネージャーC | 2025/07/12 | 〇〇プロジェクトのタスク完了 | 良い | 特になし |
-   **操作手順:**
    1.  `日報AIツール` > `週次レポート生成` を実行する。
-   **確認項目:**
    1.  マネージャーCのChatworkに、**メンバーごと**のレポートが通知されること。（テストケース `WR-001` と同様の形式）
    2.  GASの実行ログに、`weeklyReportMode`のデフォルト値が適用された旨のログが出力されること。

---

### **シナリオ4: データが存在しない場合の動作**

#### **テストケースID: WR-004**
-   **テスト内容:** 特定のメンバーまたはグループの日報データが過去1週間分存在しない場合、レポートが生成されずスキップされること。
-   **事前準備（`日報ログ`シート）**:
    *   メンバーA1の日報データを全て削除するか、全て1週間以上前の日付にする。
    *   他のメンバー（A2, B1, B2, C1, C2）のデータは通常通り準備する。
-   **操作手順:**
    1.  `日報AIツール` > `週次レポート生成` を実行する。
-   **確認項目:**
    1.  マネージャーAのChatworkには、メンバーA2のレポートのみが通知され、メンバーA1のレポートは通知されないこと。
    2.  GASの実行ログに「社員「メンバーA1」の過去1週間の日報データが見つかりませんでした。」といった内容のスキップログが出力されること。
    3.  同様に、グループBの全メンバーの日報データを削除した場合、マネージャーBにはレポートが通知されず、ログにグループBの処理がスキップされた旨のログが出力されること。

---

### **シナリオ5: トリガーによる自動実行**

#### **テストケースID: WR-005**
-   **テスト内容:** 週次トリガーによる自動実行が、各グループの`週次レポートモード`設定を正しく反映して動作すること。
-   **事前準備（`日報ログ`シート）**:
    *   テストケース `WR-001`, `WR-002`, `WR-003` の事前準備で示した全データを`日報ログ`シートに入力する。
-   **操作手順:**
    1.  `日報AIツール` > `定期実行トリガーを設定` を実行する。
    2.  GASエディタの `トリガー` 画面を開き、`generateWeeklyReports` 関数のトリガーが「毎週月曜日 午前10時」頃に設定されていることを確認する。
    3.  （テストのため）トリガーの時刻を現在時刻の数分後に変更して保存し、指定時刻を待つ。
-   **確認項目:**
    1.  指定時刻になると、`generateWeeklyReports` 関数が自動実行されること（GASの「実行数」画面で実行履歴を確認）。
    2.  マネージャーAには`individual`形式のレポートが、マネージャーBには`team`形式のレポートが、マネージャーCには`individual`形式のレポートが、それぞれ正しく通知されること。
    3.  テスト後、トリガーの時刻を元の設定に戻しておくこと。
