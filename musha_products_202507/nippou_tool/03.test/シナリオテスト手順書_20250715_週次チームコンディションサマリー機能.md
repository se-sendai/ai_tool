# 日報要約AI Chatwork連携ツール シナリオテスト手順書

## 1. テストの目的

- 新規実装された「週次チームコンディションサマリー」機能が、仕様通りに正しく動作することを確認する。
- 手動実行およびトリガーによる自動実行の両方で機能が正常に動作することを確認する。
- 本機能の追加によるデグレード（既存機能への悪影響）が発生していないことを確認する。

## 2. テスト準備

### 2.1. スプレッドシートの準備

1.  **`Chatwork設定`シート**:
    *   `manager`ロールを持つテスト用マネージャーが最低1名設定されていることを確認する。
    *   `employee`ロールを持つテスト用メンバーが複数名設定されていることを確認する。

2.  **`日報ログ`シート**:
    *   テスト前に、過去のログを一度クリアする。
    *   **過去1週間以内**の日付を持つテストデータを複数名分（最低2名、合計5件以上）入力する。
        *   データには「良い」「普通」「悪い」など、様々な`今日の気分`を混ぜて入力する。
        *   `困っていること`の項目には、「残業」「コミュニケーション」など、複数のメンバーで重複するキーワードを意図的に含める。
        *   `今日の業務内容`には、「〇〇が完了」「△△を達成」といったポジティブな内容と、通常の業務内容を混ぜて入力する。
    *   **テストデータ例（過去1週間分）**:

        | タイムスタンプ | 氏名 | マネージャー | 日報日付 | 今日の業務内容 | 今日の気分 | 困っていること | AI評価状態 | AI評価理由 |
        | :------------- | :--- | :----------- | :------- | :------------- | :--------- | :------------- | :--------- | :--------- |
        | 2025/07/08 18:00:00 | メンバーA | マネージャーX | 2025/07/08 | 企画書作成。無事提出できた。 | 良い | 特になし | 非常に良い | 問題なし |
        | 2025/07/08 18:05:00 | メンバーB | マネージャーX | 2025/07/08 | 新人教育。教えることの難しさを感じた。 | 普通 | 特になし | 普通 | 問題なし |
        | 2025/07/09 18:00:00 | メンバーC | マネージャーY | 2025/07/09 | 定例会議。議論がまとまらず疲労。 | 少し悪い | コミュニケーション不足、疲労 | 少し悪い | 会議でのコミュニケーション不足と疲労が見られるため。 |
        | 2025/07/10 18:00:00 | メンバーA | マネージャーX | 2025/07/10 | 顧客からのフィードバック対応。感謝された。 | 良い | 特になし | 非常に良い | 問題なし |
        | 2025/07/10 18:05:00 | メンバーB | マネージャーX | 2025/07/10 | 複数タスクの並行処理。優先順位付けに悩んだ。 | 普通 | タスク管理 | 普通 | 問題なし |
        | 2025/07/11 18:00:00 | メンバーB | マネージャーX | 2025/07/11 | 開発環境の構築。想定外のエラーで時間消費。 | 悪い | 環境構築、残業 | 危険 | 環境構築で想定外のエラーが発生し、残業になったため。 |
        | 2025/07/11 18:05:00 | メンバーC | マネージャーY | 2025/07/11 | チーム内勉強会に参加。新しい技術を学べた。 | 良い | 特になし | 非常に良い | 問題なし |
        | 2025/07/12 18:00:00 | メンバーA | マネージャーX | 2025/07/12 | チームミーティング。活発な議論ができた。 | 良い | 特になし | 非常に良い | 問題なし |
        | 2025/07/12 18:05:00 | メンバーC | マネージャーY | 2025/07/12 | 新規プロジェクトの調査。情報収集に苦戦。 | 普通 | 情報不足 | 普通 | 問題なし |
        | 2025/07/13 18:00:00 | メンバーA | マネージャーX | 2025/07/13 | ドキュメント作成。集中できた。 | 良い | 特になし | 非常に良い | 問題なし |
        | 2025/07/13 18:05:00 | メンバーB | マネージャーX | 2025/07/13 | 既存システムのバグ修正。デバッグに手間取った。 | 少し悪い | 残業 | 少し悪い | デバッグに時間がかかり、残業が発生したため。 |
        | 2025/07/14 18:00:00 | メンバーA | マネージャーX | 2025/07/14 | 新機能開発タスク完了。テストも問題なし。 | 良い | 特になし | 非常に良い | 問題なし |
        | 2025/07/14 18:05:00 | メンバーB | マネージャーX | 2025/07/14 | 顧客との打ち合わせ。要件定義の調整に時間がかかった。 | 普通 | コミュニケーション不足 | 普通 | 問題なし |


### 2.2. スクリプトプロパティの準備

1.  GASエディタの `プロジェクトの設定` > `スクリプト プロパティ` を開く。
2.  以下のプロパティが正しく設定されていることを確認する。
    *   `CHATWORK_API_KEY`
    *   `GEMINI_API_KEY`

---

## 3. テストシナリオ

### **シナリオ1: 手動実行による正常系動作確認**

---

#### **テストケースID: WCS-001**
-   **テスト内容:** メニューからの手動実行とサマリー生成・通知
-   **操作手順:**
    1.  `日報AIツール` > `週次チームコンディションサマリー生成` を実行する。
-   **確認項目:**
    1.  GASの実行ログに、処理開始、データ集計、Gemini API呼び出し、通知成功のログが順に出力されること。
    2.  `Chatwork設定`シートで`manager`ロールとして設定されているユーザーのChatwork（マイチャット）に、「【週次チームコンディションサマリー】」で始まる件名のメッセージがBOTから通知されること。
    3.  通知されたメッセージ本文に、Geminiが生成したサマリーレポートが含まれていること。
    4.  レポートの内容が、`日報ログ`シートの過去1週間のデータ（気分傾向、共通の課題、ポジティブな動き）を反映した、妥当な内容であること。
    5.  レポート内で、日報を提出した社員名が匿名化されていること（例：「あるメンバーは～」など）。

---

### **シナリオ2: データ集計ロジックの確認**

---

#### **テストケースID: WCS-002**
-   **テスト内容:** 日報データが集計され、正しくGeminiプロンプトに渡されているかの確認
-   **操作手順:**
    1.  `日報ログ`シートに、以下のテストデータを準備する。

        | タイムスタンプ | 氏名 | マネージャー | 日報日付 | 今日の業務内容 | 今日の気分 | 困っていること | AI評価状態 | AI評価理由 |
        | :------------- | :--- | :----------- | :------- | :------------- | :--------- | :------------- | :--------- | :--------- |
        | 2025/07/10 10:00:00 | メンバーA | マネージャーX | 2025/07/10 | 業務改善提案が採用された。 | 良い | 特になし | 非常に良い | 問題なし |
        | 2025/07/10 11:00:00 | メンバーC | マネージャーY | 2025/07/10 | 新しい技術の学習。 | 普通 | 特になし | 普通 | 問題なし |
        | 2025/07/11 10:00:00 | メンバーC | マネージャーY | 2025/07/11 | チームミーティング。 | 普通 | 特になし | 普通 | 問題なし |
        | 2025/07/11 11:00:00 | メンバーB | マネージャーX | 2025/07/11 | 開発環境のトラブル対応。 | 悪い | 残業 | 危険 | 環境トラブルで残業が発生したため。 |
        | 2025/07/12 10:00:00 | メンバーB | マネージャーX | 2025/07/12 | バグ修正に時間を要した。 | 少し悪い | 残業 | 少し悪い | バグ修正に時間がかかったため。 |
        | 2025/07/12 11:00:00 | メンバーA | マネージャーX | 2025/07/12 | 顧客からのフィードバック対応。 | 良い | 特になし | 非常に良い | 問題なし |
        | 2025/07/13 10:00:00 | メンバーA | マネージャーX | 2025/07/13 | 資料作成に集中。 | 普通 | 特になし | 普通 | 問題なし |
        | 2025/07/13 11:00:00 | メンバーC | マネージャーY | 2025/07/13 | 新規機能の調査。 | 普通 | 情報不足 | 普通 | 問題なし |
        | 2025/07/14 10:00:00 | メンバーA | マネージャーX | 2025/07/14 | プロジェクトAのタスク完了。 | 良い | 特になし | 非常に良い | 問題なし |
        | 2025/07/14 11:00:00 | メンバーB | マネージャーX | 2025/07/14 | 定例会議に参加。 | 普通 | コミュニケーション | 普通 | 問題なし |

        *期待される集計結果: 総日報数: 10件, 気分報告の傾向: 良い(3回), 普通(5回), 悪い(1回), 少し悪い(1回), 共通の課題: 残業, ポジティブな動き: 業務改善/効率化, タスク完了/目標達成。

    2.  GASエディタで `generateTeamSummaryReportWithGemini` 関数を開き、`callGeminiApi` に渡される `teamSummaryPrompt` の直前に `Logger.log(teamSummaryPrompt);` を追加して保存する。
    3.  `日報AIツール` > `週次チームコンディションサマリー生成` を実行する。
-   **確認項目:**
    1.  GASの実行ログに出力されたプロンプト内の「チーム日報データ概要」の各項目（気分報告の傾向、共通の課題、ポジティブな動き）が、手順1で準備したデータから想定される集計結果と一致していること。
    2.  テスト後、手順2で追加した `Logger.log` の行を必ず削除すること。

---

### **シナリオ3: エラーハンドリング（対象データなし）**

---

#### **テストケースID: WCS-003**
-   **テスト内容:** 対象期間に日報データが存在しない場合の動作確認
-   **操作手順:**
    1.  `日報ログ`シートの**全データをクリア**するか、**全ての日報日付を1週間以上前のものに変更**する。
        *   例: 2025/07/07以前の日付にする。
    2.  `日報AIツール` > `週次チームコンディションサマリー生成` を実行する。
-   **確認項目:**
    1.  GASの実行ログに「過去1週間の日報データがありません。」というログが出力され、処理がエラーなく終了すること。
    2.  マネージャーのChatworkに通知が送信されないこと。

---

### **シナリオ4: トリガーによる自動実行の確認**

---

#### **テストケースID: WCS-004**
-   **テスト内容:** トリガーによる自動実行の確認
-   **操作手順:**
    1.  `日報ログ`シートに、テストケースWCS-001で記載したような、過去1週間以内のテストデータを準備する。
    2.  `日報AIツール` > `定期実行トリガーを設定` を実行する。
    3.  GASエディタの `トリガー` 画面を開き、`generateWeeklyTeamSummary` 関数のトリガーが「毎週月曜日 午前10時」に設定されていることを確認する。
    4.  （テストのため）トリガーの時刻を現在時刻の数分後に変更して保存し、指定時刻を待つ。
-   **確認項目:**
    1.  指定時刻になると、`generateWeeklyTeamSummary` 関数が自動実行されること（GASの「実行数」画面で実行履歴を確認）。
    2.  マネージャーのChatworkに、テストケースID `WCS-001` と同様のサマリーレポートが通知されること。
    3.  テスト後、トリガーの時刻を元の「午前10時」に戻しておくこと。

---
