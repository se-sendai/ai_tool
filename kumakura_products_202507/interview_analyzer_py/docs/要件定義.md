# 要件定義書 - 面談データ分析AIツール (Interview Analyzer)

## 1. はじめに

本ドキュメントは、従業員の日報・面談データをAI（人工知能）を用いて効率的に分析し、面談結果の要約、具体的なアドバイス生成、日報の期間ごとの要約・アドバイス・危険信号判定、およびAI質問応答を可能にするツールの要件を定義する。

## 2. プロジェクトのゴール

*   CSV/Excelファイルを読み込み、AIで面談結果を要約し、従業員ごとに個別のCSVファイルとして出力する。
*   日報データを読み込み、AIで期間ごとの日報内容を要約し、アドバイス、危険信号を判定し、従業員ごと・期間ごとのCSVファイルとして出力する。
*   要約データ（面談・日報）をもとにしたAI質問応答機能を提供する。
*   ローカルPCで動作し、PyInstallerで単一の実行ファイルとして配布可能であること。
*   AI利用は無料枠内を基本とし、ユーザーが課金に同意する場合のみ有料サービスを利用可能とする。

## 3. 入力データに関する要件

### 3.1. 入力ファイル形式

*   Excelファイル（.xlsx）またはCSVファイル（.csv）に対応する。
*   ファイル名/シート名は固定せず、プログラムで指定できるようにする。

### 3.2. 入力データ構造

#### 3.2.1. 面談データ

*   AIがデータサンプルから「横持ち」または「縦持ち」形式を判断する。
*   **横持ち形式の場合**: 各行が1人の従業員に対応し、各列が面談項目に対応する。
    *   AIがデータサンプルから「従業員を識別する列」「面談のフリーコメントを含む列」「得意分野を示すキーワードを含む列」を**厳密に特定**する。
    *   AIは、提供されたCSVデータ内の列名を**一字一句そのまま**使用して特定する。
    *   プログラムは、AIの判断に基づき、入力ファイルの全項目とその内容を`列名: 内容`の形式でテキスト化し、AIに要約をリクエストする。
*   **縦持ち形式の場合**: 「項目」「記入内容」の2列を持つ。
    *   AIがデータサンプルから「項目」列と「記入内容」列を特定し、さらに「従業員を識別する項目」「面談コメントに該当する項目」「得意分野に該当する項目」を**厳密に特定**する。
    *   プログラムは、AIの判断に基づき、入力ファイルの全項目とその内容を`項目: 内容`の形式でテキスト化し、AIに要約をリクエストする。
    *   プログラムが自動で「縦持ち」から「横持ち」形式に変換し、固定列名を使用する。
*   従業員を識別する情報（氏名、従業員IDなど）や得意分野に関する情報は、AIの判断結果に基づいてプログラムが抽出し、出力ファイルに反映する。

#### 3.2.2. 日報データ

*   Excelファイル（.xlsx）形式を想定する。
*   各シートが1人の従業員の日報データに対応する。
*   シート名が従業員名となる。
*   「表紙」シートは処理対象外とする。
*   各シートは以下の列を持つことを想定する。
    *   `タイムスタンプ` (日報の日付)
    *   `今日の体調`
    *   `今日の気分`
    *   `今日の業務内容`
    *   `業務での課題や悩み`
    *   `その他、共有事項`

## 4. 出力データに関する要件

### 4.1. 出力ファイル形式

*   各従業員ごと、または従業員ごと・期間ごとに**個別のCSVファイル（.csv）**として出力する。

### 4.2. ファイル名

*   **面談データ**: 以下のルールで動的に生成する。
    *   「面談日」が取得できた場合、ファイル名は `{従業員名}_{面談日}.csv` とする。(例: `山田太郎_20250714.csv`)
    *   「面談日」が取得できなかった場合、ファイル名は `{従業員名}_{処理実行時の日時}.csv` とし、日時は `YYYYMMDD-HHMMSS` 形式とする。(例: `鈴木花子_20250714-103249.csv`)
    *   従業員名が不明で従業員IDが取得できた場合、ファイル名は `{従業員ID}_{面談日}.csv` または `{従業員ID}_{処理実行時の日時}.csv` とする。
*   **日報データ**: 従業員名と期間を含んだ分かりやすいファイル名にする（例: `鈴木花子_20240101-20240107_日報分析.csv`）。

### 4.3. 出力内容

#### 4.3.1. 面談データ

*   「面談結果要約」は、入力ファイルの**全項目と内容を基に**、AIが「主要な成果と強み」「課題と改善点」「今後の目標と期待」「その他の特記事項」を**構造化された箇条書き形式**で抽出・整理した内容とする。AIの応答には、会話的な前置きや相槌は含まれない。
*   AIによる「AIによるアドバイス」の列を追加する。AIの応答には、会話的な前置きや相槌は含まれない。
*   AIによる要約/アドバイスが何らかの理由でできなかった場合（APIエラー、内容が短すぎるなど）は、当該セルに「要約できませんでした」/「アドバイスを生成できませんでした」と出力する。

#### 4.3.2. 日報データ

*   期間ごとの日報内容のまとめ、AIによるアドバイス、危険信号の有無、危険信号の根拠の列を追加する。
*   「日報内容要約」は、期間内の日報内容から「主要な業務内容と成果」「課題と改善点」「気づきや学び」「その他特記事項」を**構造化された箇条書き形式**で抽出・整理した内容とする。
*   「AIによるアドバイス」は、日報内容要約を基に、従業員がさらに成長するための具体的でポジティブなアドバイスを生成する。
*   「危険信号」は、業務上の問題、体調不良、日報内容の支離滅裂さのいずれか、または複数に該当するかを `true`/`false` で判定する。
*   「危険信号の根拠」は、危険信号の判断理由を簡潔に説明する。

### 4.4. 出力先ディレクトリ

*   実行ファイルと同じディレクトリにデフォルトで `要約結果` フォルダ（面談データ用）と `日報分析結果` フォルダ（日報データ用）を作成し、その中に出力する。

### 4.5. データベースへの保存

*   面談要約結果および日報分析結果は、AI質問応答機能の知識ベースとして、ローカルのSQLiteデータベース（`analyzer_data.db`）に保存される。
*   データベースには、従業員名、従業員ID、面談日、要約内容、AIによるアドバイスなどが格納される。

## 5. AI機能に関する要件

### 5.1. AIバックエンドの選択

*   `config.ini` を通じて、Google Gemini API またはローカルで動作するOllamaのどちらかを選択可能とする。

### 5.2. 面談結果要約

*   入力ファイル内の面談コメントを含む列のテキストを、選択されたAIバックエンドを用いて、**構造化された形式で**要約する。

### 5.3. AIによるアドバイス生成

*   生成された面談結果要約または日報内容要約を基に、AIが具体的でポジティブな成長アドバイスを生成する。

### 5.4. 日報内容要約

*   期間内の日報内容を、選択されたAIバックエンドを用いて、**構造化された形式で**要約する。

### 5.5. 危険信号判定

*   期間内の日報内容を基に、AIが業務上の問題、体調不良、日報内容の支離滅裂さのいずれか、または複数に該当する「危険信号」を `true`/`false` で判定し、その根拠を生成する。

### 5.6. AI質問応答機能

*   **知識ベース**: 面談データ要約（`要約結果` フォルダ内のファイル）と日報分析結果（`日報分析結果` フォルダ内のファイル）の内容全体をAIの知識ベースとして利用する。
*   ユーザーが自然言語で質問を入力し、AIがその情報に基づいて回答を生成する。

## 6. 技術要件

### 6.1. 開発言語

*   Python

### 6.2. 主要ライブラリ

*   `pandas`: データ処理（読み込み、抽出、要約）
*   `openpyxl`: Excel ファイルの読み書き（入力にExcelを使用する場合）
*   `google-generativeai`: Google Gemini API 連携
*   `requests`: Ollama API 連携
*   `configparser`: APIキーなどの設定ファイル読み込み
*   `PyInstaller`: 単一実行ファイル化

### 6.3. AIモデル

*   Google Gemini 2.0 Flash (または同等以上のモデル)
*   Ollamaで利用可能なモデル（例: Llama 3, Gemma 3など）

### 6.4. APIキーの管理

*   APIキーはコードに直接記述せず、実行ファイルと同じディレクトリに配置する設定ファイル (`config.ini`) から読み込む形式とする。

## 7. 非機能要件

### 7.1. 性能要件

*   100件の面談データ（各面談コメント2000文字程度を想定）を、要約・アドバイス生成を含め、概ね5分以内に処理完了することを目指す。
*   日報データは、100日分（各日報500文字程度）を週次で集計・分析し、概ね5分以内に処理完了することを目指す。
*   AI質問応答の応答時間は、質問内容とAIバックエンドの性能に依存するが、概ね10秒以内を目指す。

### 7.2. セキュリティ要件

*   APIキーは設定ファイル (`config.ini`) から読み込み、コードに直接記述しない。
*   個人情報を含む面談データおよび日報データは、ユーザーのローカルPC外に明示的な同意なく送信されない（AIバックエンドへの送信は、要約・アドバイス生成に必要な範囲のテキストデータのみとする）。
*   AIバックエンドとの通信は、HTTPSなどの暗号化されたプロトコルを使用する。

### 7.3. スケーラビリティ要件

*   MVPの段階では、最大で数千行（数MB程度）の面談データファイルを処理可能とする。
*   日報データは、100日分（各日報500文字程度）のデータを処理可能とする。
*   将来的な大規模データ対応（数万行以上）には、RAG (Retrieval-Augmented Generation) などの技術導入を検討する。

### 7.4. 可用性要件

*   AIバックエンドサービスが利用できない場合（ネットワーク障害、APIエラー、クォータ制限など）でも、処理が停止せず、適切なエラーメッセージをログに出力し、ユーザーにフィードバックすること。

## 8. ユーザーインターフェースに関する要件

### 8.1. 操作性

*   GUI（グラフィカル・ユーザー・インターフェース）による対話形式で操作可能とする。
*   起動時に、以下の操作を選択できるモード選択機能を提供する。
    1.  **新しい面談ファイルを分析して要約を作成する**: 従来通り、ファイル/ディレクトリパスを入力して分析処理を実行する。
    2.  **既存の要約データを使ってAIと対話する**: `要約結果` フォルダおよび `日報分析結果` フォルダ内の既存データを読み込み、即座にAI質問応答セッションを開始する。**AI対話中は、他のモード選択はできない。**
    3.  **日報データを分析する**: 指定された日報Excelファイルを読み込み、期間ごとの日報内容を要約し、アドバイス、危険信号を判定する。
*   ファイル/ディレクトリパスの入力、AI質問応答など、ユーザーが直感的に操作できるプロンプトを提供する。

### 8.2. 配布

*   PyInstallerを使用し、Python環境がインストールされていないPCでも動作する単一の実行ファイルとしてビルドできること。
*   `interview_analyzer_gui.exe` と `config.ini`、`使い方.md` をセットで配布する。また、ドラッグ＆ドロップ機能のために `tkinterdnd2` が必要となる。

## 9. AI利用におけるユーザー課金ポリシー

*   AI利用は無料枠内を基本とし、ユーザーが課金に同意する場合のみ有料サービスを利用可能とする。
*   **同意の取得方法**: `config.ini` ファイル内の設定（例: `allow_paid_api = true/false`）による明示的なオプトインを想定する。MVPのスコープ外である「API利用時の料金発生に関するユーザーへの警告機能」は、この設定と連動して実装される。

## 10. エラーハンドリングとログ

### 10.1. エラーメッセージ

*   入力ファイルの形式が間違っていたり、必須の列が見つからなかったりした場合、具体的なエラー内容をユーザーに分かりやすく表示する。
*   AI APIの呼び出しエラー（クォータ制限、接続エラーなど）も適切に表示する。

### 10.2. ログファイル

*   処理の進捗状況や発生したエラー、要約結果（成功/失敗）などを記録するためのログファイルを、実行ファイルと同じ階層に作成される `logs` フォルダに `YYYYMMDD_HHMMSS_processing.log` の形式で出力する。
*   ファイル名はYYYYMMDD_HHMMSS_processing.logなど、日付と時刻を含む形式とする。
*   ログファイルは実行ファイルと同じ階層に作成される `logs` フォルダに格納する。

## 11. 今後の展望（MVPスコープ外）

*   GUI（グラフィカルユーザーインターフェース）の実装
*   RAG (Retrieval-Augmented Generation) による大規模データ対応
*   より高度な分析機能（トレンド分析、スキルギャップ分析など）
*   レポート自動生成機能
*   API利用時の料金発生に関するユーザーへの警告機能